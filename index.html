<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESS Proposal Gateway</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }
    .screen { display: none; }
    .screen.active { display: block; }
    .option-card { transition: all 0.2s; cursor: pointer; border: 2px solid #e5e7eb; border-radius: 1rem; padding: 1.5rem; }
    .option-card:hover { transform: translateY(-2px); }
    .option-card.selected { border-color: #6366f1; background: #eef2ff; box-shadow: 0 0 0 3px rgba(99,102,241,0.2); }
    .back-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: #f3f4f6; color: #374151; border-radius: 0.75rem; font-weight: 500; transition: all 0.2s; cursor: pointer; }
    .back-btn:hover { background: #e5e7eb; }
    input[type="checkbox"] { cursor: pointer; transform: scale(1.3); margin-right: 0.5rem; }
    input[type="range"] { cursor: pointer; width: 100%; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen py-10">

<div class="max-w-5xl mx-auto px-5">

  <!-- SCREEN 1 ‚Äì Questionnaire -->
  <div id="screen-questionnaire" class="screen active">
    <div class="text-center mb-10">
      <h1 class="text-4xl font-bold text-indigo-700">ESS Proposal Gateway</h1>
      <p class="text-lg text-gray-600 mt-3">Answer 10 questions to classify your project track</p>
    </div>
    <div class="bg-white rounded-2xl shadow-lg p-8 md:p-10 max-w-3xl mx-auto">
      <div class="mb-8">
        <div class="flex justify-between text-sm text-gray-500 mb-2">
          <span>Question <strong id="q-num">1</strong>/10</span>
          <span id="progress-pct">0% complete</span>
        </div>
        <div class="h-2 bg-gray-200 rounded-full">
          <div id="progress" class="h-2 bg-indigo-600 rounded-full w-0 transition-all"></div>
        </div>
      </div>
      <h2 id="question-text" class="text-2xl font-semibold mb-8 min-h-[4rem]"></h2>
      <div id="options" class="grid gap-5"></div>
      <div class="flex justify-between mt-12">
        <button id="btn-prev" onclick="prev()" class="px-8 py-3 text-gray-600 hover:text-gray-900 font-medium hidden">‚Üê Previous</button>
        <button id="btn-next" onclick="next()" class="px-10 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl">Next ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- SCREEN 2 ‚Äì Questionnaire Result -->
  <div id="screen-result" class="screen">
    <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12">
      <button onclick="restartQuestionnaire()" class="back-btn mb-8">‚Üê Start New Questionnaire</button>
      <div class="text-center mb-10">
        <div id="result-emoji" class="text-7xl mb-4"></div>
        <span id="result-badge" class="inline-block px-5 py-1.5 bg-indigo-100 text-indigo-700 font-bold rounded-full"></span>
        <h2 id="result-title" class="text-3xl font-bold mt-4"></h2>
        <p id="result-subtitle" class="text-lg text-gray-600 mt-2"></p>
      </div>
      <div class="grid md:grid-cols-2 gap-10 mb-12">
        <div><h3 class="font-semibold text-center mb-4">Questionnaire Score</h3><canvas id="barChart" height="160"></canvas></div>
        <div><h3 class="font-semibold text-center mb-4">Track Distribution</h3><canvas id="pieChart" height="160"></canvas></div>
      </div>
      <div class="bg-indigo-50 border border-indigo-200 rounded-2xl p-8 mb-12">
        <h3 class="text-xl font-bold mb-4 text-indigo-800">Recommended Proposal Framework</h3>
        <p class="text-gray-700 mb-6">
          Click below to see the complete proposal structure we recommend and use as reference when analyzing your uploaded proposal.
        </p>
        <button onclick="showFramework()" class="w-full sm:w-auto px-10 py-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl">
          Show Recommended Proposal Framework ‚Üí
        </button>
      </div>
      <div class="border border-dashed border-gray-400 rounded-2xl p-10 bg-gray-50">
        <h3 class="text-xl font-bold mb-4 text-center">Compare your existing proposal</h3>
        <p class="text-center text-gray-600 mb-6">
          Upload your current proposal draft to see how well it aligns with the recommended framework.<br>
          <strong class="text-amber-700">PDF tip:</strong> If your file is PDF, copy the text into Notepad or Word and save as .txt for best results.
        </p>
        <div class="flex flex-col items-center gap-5">
          <input type="file" id="file-upload" accept=".txt,.md,.pdf" class="block w-full max-w-md text-sm text-gray-500 file:mr-4 file:py-3 file:px-6 file:rounded-xl file:border-0 file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
          <button onclick="analyzeFile()" class="px-12 py-4 bg-gray-800 hover:bg-gray-900 text-white font-semibold rounded-xl">
            Analyze File
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- SCREEN 3 ‚Äì Document Analysis Result -->
  <div id="screen-analysis" class="screen">
    <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12">
      <button onclick="goBackToResult()" class="back-btn mb-8">‚Üê Back to questionnaire result</button>
      <h2 class="text-3xl font-bold mb-8 text-center">Document Match Analysis</h2>
      <div id="analysis-bars" class="space-y-8 mb-12"></div>
      <div id="analysis-missing" class="bg-amber-50 border border-amber-200 rounded-2xl p-8 mb-12"></div>
      <div class="bg-blue-50 border border-blue-200 rounded-2xl p-8 mb-12 text-center">
        <p class="text-lg font-medium text-blue-800 mb-4">
          It is recommended that your proposal matches the selected track at <strong>above 70%</strong><br>
          before proceeding with execution planning based on track analysis.
        </p>
      </div>
      <div class="text-center">
        <button onclick="showExecution()" class="px-12 py-5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-lg rounded-xl">
          View Project Implementation and Execution ‚Üí
        </button>
      </div>
    </div>
  </div>

  <!-- SCREEN 4 ‚Äì Execution & Implementation (now comprehensive) -->
  <div id="screen-execution" class="screen">
    <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12">
      <button onclick="goBackToAnalysis()" class="back-btn mb-8">‚Üê Back to analysis results</button>
      <h2 class="text-3xl font-bold mb-8 text-center">Project Implementation & Execution Framework</h2>
      <p id="execution-track" class="text-xl text-center mb-10 font-medium"></p>
      <div id="execution-content" class="prose max-w-none text-gray-800"></div>
      <div class="mt-16 text-center space-y-6">
        <button onclick="showProgressDashboard()" class="px-12 py-5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-lg rounded-xl">
          Go to Project Progress Dashboard
        </button>
        <button onclick="showPrintableFramework()" class="px-12 py-5 bg-green-600 hover:bg-green-700 text-white font-bold text-lg rounded-xl">
          View Full Printable Implementation Framework ‚Üí
        </button>
      </div>
    </div>
  </div>

  <!-- SCREEN 5 ‚Äì Printable Full Framework -->
  <div id="screen-printable" class="screen bg-white min-h-screen p-8 md:p-16">
    <div class="max-w-4xl mx-auto">
      <button onclick="history.back()" class="back-btn mb-10">‚Üê Back</button>
      <div class="flex justify-between items-center mb-12 border-b pb-6">
        <h1 id="print-title" class="text-4xl font-bold"></h1>
        <button onclick="window.print()" class="px-8 py-4 bg-gray-800 hover:bg-black text-white font-semibold rounded-xl">
          üñ®Ô∏è Print / Save as PDF
        </button>
      </div>
      <div id="print-content" class="prose prose-lg"></div>
      <div class="mt-20 text-center text-gray-500 text-sm">
        Generated by ESS Proposal Gateway ‚Ä¢ Abuja, Nigeria ‚Ä¢ 2026
      </div>
    </div>
  </div>

  <!-- SCREEN 6 ‚Äì Project Progress Dashboard -->
  <div id="screen-progress" class="screen">
    <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12">
      <button onclick="goBackToExecution()" class="back-btn mb-8">‚Üê Back to Execution</button>
      <h2 class="text-3xl font-bold mb-8 text-center">Project Progress Dashboard</h2>

      <div class="flex gap-4 mb-8 border-b pb-4">
        <button onclick="switchDashboardMode('owner')" class="flex-1 py-3 font-semibold rounded-xl bg-indigo-600 text-white pointer-events-auto">
          Project Owner View ‚Äì Update Progress
        </button>
        <button onclick="switchDashboardMode('admin')" class="flex-1 py-3 font-semibold rounded-xl bg-gray-200 pointer-events-auto">
          Admin / Supervisor View ‚Äì Track Progress
        </button>
      </div>

      <div id="owner-view">
        <div class="mb-8">
          <h3 class="font-bold text-xl mb-4">Set Project Timeline</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>Overall Start: <input type="date" id="overall-start" class="border p-2 rounded w-full pointer-events-auto" onchange="saveProgressData()"></div>
            <div>Overall End: <input type="date" id="overall-end" class="border p-2 rounded w-full pointer-events-auto" onchange="saveProgressData()"></div>
          </div>
        </div>
        <div id="phases-owner" class="space-y-8"></div>
      </div>

      <div id="admin-view" class="hidden">
        <div id="admin-progress" class="space-y-8"></div>
        <div class="mt-8">
          <h3 class="font-bold text-xl mb-4">Send Update Request / Message to Project Owner</h3>
          <textarea id="admin-message" class="w-full border p-4 rounded-xl h-32 pointer-events-auto" placeholder="Type message, request update, or ask for clarification..."></textarea>
          <button onclick="sendAdminMessage()" class="mt-4 px-8 py-3 bg-indigo-600 text-white font-semibold rounded-xl pointer-events-auto">
            Send Message / Request Update
          </button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Data & Globals (same as your working version)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentQ = 0;
let answers = new Array(10).fill(null);
let analysisResult = null;
let progressData = JSON.parse(localStorage.getItem('essProgressData')) || {
  overallStart: '',
  overallEnd: '',
  phases: []
};

const trackInfo = {
  A: {letter:"A", name:"Discovery", emoji:"üî¨", focus:"Pure Research & Development", color:"#4f46e5"},
  B: {letter:"B", name:"Venture", emoji:"üí∞", focus:"Profit-Making & Commercialization", color:"#10b981"},
  C: {letter:"C", name:"Impact", emoji:"üåç", focus:"Social, Humanitarian & Environmental", color:"#f59e0b"}
};

const signatures = {
  common: [/executive summary/i, /problem statement/i, /budget/i, /risk/i, /mitigation/i, /timeline/i, /milestone/i],
  A: [/literature review/i, /state of the art/i, /intellectual merit/i, /citations/i, /peer reviewed/i, /preliminary data/i, /hypothesis/i, /methodology/i],
  B: [/market analysis/i, /tam/i, /total addressable market/i, /competitive landscape/i, /go to market/i, /revenue/i, /roi/i, /business model/i, /traction/i],
  C: [/theory of change/i, /beneficiar/i, /sustainability/i, /logframe/i, /indicator/i, /outcome/i, /impact/i, /scale/i]
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Navigation (unchanged)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Questionnaire (exactly as in your working version)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderQuestion() {
  const q = questions[currentQ];
  document.getElementById('q-num').textContent = currentQ + 1;
  document.getElementById('progress').style.width = `${((currentQ + 1)/10)*100}%`;
  document.getElementById('progress-pct').textContent = `${Math.round(((currentQ + 1)/10)*100)}% complete`;
  document.getElementById('question-text').textContent = q.text;

  const opts = document.getElementById('options');
  opts.innerHTML = '';
  q.options.forEach(o => {
    const div = document.createElement('div');
    div.className = `option-card ${answers[currentQ] === o.track ? 'selected' : ''}`;
    div.innerHTML = `<div class="text-5xl mb-3">${o.emoji}</div><div class="text-lg font-medium">${o.text}</div>`;
    div.onclick = () => {
      answers[currentQ] = o.track;
      renderQuestion();
    };
    opts.appendChild(div);
  });

  document.getElementById('btn-prev').classList.toggle('hidden', currentQ === 0);
  document.getElementById('btn-next').textContent = currentQ === 9 ? 'Finish & See Result' : 'Next ‚Üí';
}

function next() {
  if (!answers[currentQ]) return alert('Please select an option');
  if (currentQ < 9) {
    currentQ++;
    renderQuestion();
  } else {
    finishQuestionnaire();
  }
}

function prev() {
  if (currentQ > 0) {
    currentQ--;
    renderQuestion();
  }
}

function finishQuestionnaire() {
  localStorage.setItem('essQuestionnaire', JSON.stringify(answers));
  showScreen('screen-result');
  renderQuestionnaireResult();
}

function renderQuestionnaireResult() {
  const scores = {A:0, B:0, C:0};
  answers.forEach(t => { if (t) scores[t]++; });
  const max = Math.max(scores.A, scores.B, scores.C);
  const primary = scores.A === max ? 'A' : scores.B === max ? 'B' : 'C';
  const info = trackInfo[primary];

  document.getElementById('result-emoji').textContent = info.emoji;
  document.getElementById('result-badge').textContent = `Track ${info.letter} ‚Äì ${info.name}`;
  document.getElementById('result-title').textContent = `Your project aligns most with ${info.name}`;
  document.getElementById('result-subtitle').textContent = info.focus;

  const labels = ['Discovery (A)', 'Venture (B)', 'Impact (C)'];
  const data = [scores.A, scores.B, scores.C];

  new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {labels, datasets:[{data, backgroundColor:['#4f46e5','#10b981','#f59e0b']}]},
    options: {indexAxis:'y', plugins:{legend:{display:false}}, scales:{x:{max:10}}}
  });

  new Chart(document.getElementById('pieChart'), {
    type: 'doughnut',
    data: {labels, datasets:[{data:data.map(v=>v*10), backgroundColor:['#4f46e5','#10b981','#f59e0b']}]},
    options: {cutout:'65%', plugins:{legend:{position:'bottom'}}}
  });
}

function restartQuestionnaire() {
  currentQ = 0;
  answers.fill(null);
  localStorage.removeItem('essQuestionnaire');
  showScreen('screen-questionnaire');
  renderQuestion();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// File Analysis (unchanged from your working version)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function analyzeFile() {
  const file = document.getElementById('file-upload').files[0];
  if (!file) return alert('Please select a file.');
  let text = '';
  const ext = file.name.split('.').pop().toLowerCase();
  try {
    if (ext === 'txt' || ext === 'md') {
      text = await file.text();
    } else if (ext === 'pdf') {
      text = await extractPDFText(file);
    } else {
      return alert('Only .txt, .md, .pdf files supported.');
    }
    const norm = text.toLowerCase().replace(/\s+/g, ' ').trim();
    const counts = {A:0, B:0, C:0, common:0};
    Object.keys(signatures).forEach(k => {
      signatures[k].forEach(r => { if (r.test(norm)) counts[k]++; });
    });
    const totals = {
      A: signatures.A.length + signatures.common.length,
      B: signatures.B.length + signatures.common.length,
      C: signatures.C.length + signatures.common.length
    };
    const scores = {
      A: Math.round((counts.A + counts.common) / totals.A * 100) || 0,
      B: Math.round((counts.B + counts.common) / totals.B * 100) || 0,
      C: Math.round((counts.C + counts.common) / totals.C * 100) || 0
    };
    analysisResult = {scores, primaryTrack: getHighestTrack(scores)};
    renderAnalysis(scores);
    showScreen('screen-analysis');
  } catch (err) {
    alert('File processing failed.\n' + err.message);
  }
}
function getHighestTrack(scores) {
  let max = -1, tr = 'A';
  for (let k in scores) if (scores[k] > max) { max = scores[k]; tr = k; }
  return tr;
}
function renderAnalysis(scores) {
  const cont = document.getElementById('analysis-bars');
  cont.innerHTML = '';
  ['A','B','C'].forEach(k => {
    const p = scores[k];
    cont.innerHTML += `
      <div class="bg-gray-50 p-5 rounded-xl">
        <div class="flex justify-between mb-2 font-semibold">
          <span>Track ${k} ‚Äì ${trackInfo[k].name}</span>
          <span>${p}%</span>
        </div>
        <div class="h-4 bg-gray-200 rounded-full overflow-hidden">
          <div class="h-full transition-all duration-700" style="width:${p}%; background:${trackInfo[k].color}"></div>
        </div>
      </div>`;
  });
  document.getElementById('analysis-missing').innerHTML = `
    <h4 class="font-bold text-amber-800 mb-4">Detected / missing elements (example):</h4>
    <p>Common sections: executive summary, problem statement, budget...</p>
  `;
}
async function extractPDFText(file) {
  const ab = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data: ab}).promise;
  let txt = [];
  for (let i = 1; i <= Math.min(20, pdf.numPages); i++) {
    const page = await pdf.getPage(i);
    const c = await page.getTextContent();
    txt.push(c.items.map(it => it.str).join(' '));
  }
  return txt.join(' ');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Proposal Framework (unchanged)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showFramework() {
  const saved = localStorage.getItem('essQuestionnaire');
  if (!saved) return alert('No questionnaire data found.');
  const ans = JSON.parse(saved);
  const scores = {A:0,B:0,C:0};
  ans.forEach(t => {if(t) scores[t]++;});
  const max = Math.max(scores.A, scores.B, scores.C);
  const track = scores.A === max ? 'A' : scores.B === max ? 'B' : 'C';
  const title = `Recommended Proposal Framework ‚Äì Track ${trackInfo[track].letter} (${trackInfo[track].name})`;
  let content = `
    <h1 class="text-4xl font-bold mb-10">${title}</h1>
    <p class="text-xl text-gray-700 mb-12">This is the standard structure we use when analyzing uploaded proposals.</p>
    <div class="space-y-12">
      <div>
        <h2 class="text-2xl font-bold mb-6">Core Sections</h2>
        <div class="grid md:grid-cols-2 gap-6">
  `;
  const sections = track === 'A' ? [
    'Executive Summary & Abstract', 'State-of-the-Art Literature Review', 'Research Questions / Hypotheses',
    'Intellectual Merit & Innovation', 'Preliminary Results / Proof of Concept', 'Detailed Methodology',
    'Data Management & Sharing Plan', 'Publication & Dissemination Strategy', 'Timeline & Milestones'
  ] : track === 'B' ? [
    'One-Page Executive Pitch', 'Market Opportunity (TAM / SAM / SOM)', 'Product / Solution Description',
    'Competitive Landscape & Positioning', 'Go-to-Market & Sales Strategy', 'Business Model & Revenue Streams',
    'Financial Projections (3‚Äì5 years)', 'Team & Governance', 'IP, Regulatory & Use of Funds'
  ] : [
    'Executive Summary & Impact Goal', 'Problem & Needs Assessment (baseline)', 'Theory of Change / Logframe',
    'Beneficiary & Stakeholder Analysis', 'Intervention Activities & Inputs', 'Monitoring & Evaluation Plan',
    'Sustainability & Exit Strategy', 'Risks, Assumptions & Mitigation'
  ];
  sections.forEach(s => {
    content += `<div class="bg-gray-50 p-6 rounded-xl border"><strong>${s}</strong><p class="text-sm text-gray-600 mt-2">(detailed guidance here)</p></div>`;
  });
  content += `</div></div></div>`;
  document.getElementById('print-title').textContent = title;
  document.getElementById('print-content').innerHTML = content;
  showScreen('screen-printable');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Execution Page ‚Äì now fully fleshed out (as requested)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showExecution() {
  if (!analysisResult) return alert('No analysis result.');
  const tr = analysisResult.primaryTrack;
  const info = trackInfo[tr];
  document.getElementById('execution-track').innerHTML = `Execution & Implementation Framework ‚Äì Track ${info.letter} (${info.name}) ‚Äì <strong>${analysisResult.scores[tr]}%</strong> document match`;

  let phasesHTML = '';
  if (tr === 'A') {
    phasesHTML = `
      <div class="space-y-12">
        <div>
          <h3 class="text-2xl font-bold mb-4">Overall Strategy</h3>
          <p class="text-gray-700 mb-4">Long-term exploratory research emphasizing scientific novelty, rigorous methodology, reproducibility, and contribution to global knowledge. Timeline: 36 months. Key principles: open science, data integrity, peer validation.</p>
        </div>
        <div>
          <h3 class="text-2xl font-bold mb-4">Visual Timeline (Gantt-style)</h3>
          <canvas id="ganttChart" height="140"></canvas>
        </div>
        <div class="space-y-10">
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 1: Foundation (Months 1‚Äì12)</h4>
            <p class="text-gray-700 mb-4">Strategy: Establish rigorous scientific base, obtain all necessary approvals, collect pilot data, validate methods, and prepare for core research.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Ethics/IRB/Regulatory approval secured</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Comprehensive literature review and gap analysis completed</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Pilot study designed, executed, and preliminary data collected</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Research protocol and methods validated</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetA1">0</span> / ‚Ç¶3,500,000</label>
              <input type="range" min="0" max="3500000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetA1').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Performance Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="Pilot data points collected">
            <input type="number" class="border p-3 w-full rounded" placeholder="Preliminary publications / preprints drafted">
          </div>
          <!-- Phase 2 -->
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 2: Core Research (Months 13‚Äì24)</h4>
            <p class="text-gray-700 mb-4">Strategy: Execute main experiments, collect primary dataset, perform advanced analysis, draft initial manuscripts.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Primary dataset fully collected</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Statistical / computational analysis completed</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Preliminary results presented to collaborators / seminars</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> First manuscript drafted and internally reviewed</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetA2">0</span> / ‚Ç¶4,000,000</label>
              <input type="range" min="0" max="4000000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetA2').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Performance Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="Main dataset size (GB / samples)">
            <input type="number" class="border p-3 w-full rounded" placeholder="Analysis scripts / models completed">
          </div>
          <!-- Phase 3 -->
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 3: Synthesis & Dissemination (Months 25‚Äì36)</h4>
            <p class="text-gray-700 mb-4">Strategy: Finalize analysis, publish in high-impact journals, present at international conferences, archive data for open access.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> 3+ peer-reviewed publications submitted / accepted</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> International conference presentations delivered</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Data repository populated and DOI assigned</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Final project report and knowledge transfer completed</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetA3">0</span> / ‚Ç¶2,500,000</label>
              <input type="range" min="0" max="2500000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetA3').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Performance Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="Publications accepted">
            <input type="number" class="border p-3 w-full rounded" placeholder="Conference presentations delivered">
          </div>
        </div>
      </div>
    `;
  } else if (tr === 'B') {
    phasesHTML = `
      <div class="space-y-12">
        <div>
          <h3 class="text-2xl font-bold mb-4">Overall Strategy</h3>
          <p class="text-gray-700 mb-4">Accelerated path to market with focus on product validation, revenue growth, scalable operations, and investor readiness. Timeline: 24 months. Key principles: customer-centric iteration, unit economics, rapid traction.</p>
        </div>
        <div>
          <h3 class="text-2xl font-bold mb-4">Visual Timeline (Gantt-style)</h3>
          <canvas id="ganttChart" height="140"></canvas>
        </div>
        <div class="space-y-10">
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 1: MVP & Validation (Months 1‚Äì6)</h4>
            <p class="text-gray-700 mb-4">Strategy: Build MVP, validate with real users, achieve early traction, iterate based on feedback.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> MVP developed and launched</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Beta testing with 100+ users completed</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Product-market fit validated (NPS > 40)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Initial revenue stream activated</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetB1">0</span> / ‚Ç¶4,000,000</label>
              <input type="range" min="0" max="4000000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetB1').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Performance Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="Early users / customers acquired">
            <input type="number" class="border p-3 w-full rounded" placeholder="Initial revenue generated (‚Ç¶)">
          </div>
          <!-- Phase 2 -->
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 2: Growth & Revenue (Months 7‚Äì18)</h4>
            <p class="text-gray-700 mb-4">Strategy: Scale customer acquisition, optimize unit economics, build repeatable sales/marketing engine.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> 500+ paying customers acquired</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Monthly recurring revenue > ‚Ç¶5M</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> CAC payback period < 12 months</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Marketing channels optimized (CAC reduced 30%+)</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetB2">0</span> / ‚Ç¶3,500,000</label>
              <input type="range" min="0" max="3500000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetB2').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Performance Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="Paying customers added this phase">
            <input type="number" class="border p-3 w-full rounded" placeholder="MRR achieved (‚Ç¶)">
          </div>
          <!-- Phase 3 -->
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 3: Expansion & Exit Prep (Months 19‚Äì24)</h4>
            <p class="text-gray-700 mb-4">Strategy: Expand to new markets, scale operations, prepare for funding round or strategic exit.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> New regional market launched</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> ARR > ‚Ç¶50M achieved</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Investor-ready pitch deck & financial model completed</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Exit strategy roadmap defined</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetB3">0</span> / ‚Ç¶2,500,000</label>
              <input type="range" min="0" max="2500000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetB3').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="New market customers acquired">
            <input type="number" class="border p-3 w-full rounded" placeholder="ARR achieved (‚Ç¶)">
          </div>
        </div>
        <div class="mt-12 bg-gray-100 p-6 rounded-xl">
          <h3 class="text-2xl font-bold mb-4">Overall Progress</h3>
          <div class="h-4 bg-gray-300 rounded-full overflow-hidden">
            <div class="h-full bg-green-500" style="width:0%"></div>
          </div>
          <p class="text-center mt-2 text-gray-600">0% complete ‚Ä¢ ‚Ç¶0 spent</p>
        </div>
      </div>
    `;
  } else {
    phasesHTML = `
      <div class="space-y-12">
        <div>
          <h3 class="text-2xl font-bold mb-4">Overall Strategy</h3>
          <p class="text-gray-700 mb-4">Medium to long-term sustainable development with focus on measurable social/environmental impact, community ownership, and lasting systems change. Timeline: 36 months. Key principles: ToC, inclusion, adaptive MEL.</p>
        </div>
        <div>
          <h3 class="text-2xl font-bold mb-4">Visual Timeline (Gantt-style)</h3>
          <canvas id="ganttChart" height="140"></canvas>
        </div>
        <div class="space-y-10">
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 1: Preparation & Baseline (Months 1‚Äì12)</h4>
            <p class="text-gray-700 mb-4">Strategy: Conduct rigorous baseline, build stakeholder trust, train teams, establish MEL framework.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Baseline survey and data collection completed</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Community leaders and stakeholders fully engaged</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> MEL tools, indicators, and data collection systems deployed</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Field staff and partners trained</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetC1">0</span> / ‚Ç¶3,000,000</label>
              <input type="range" min="0" max="3000000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetC1').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="Beneficiaries mapped / enrolled">
            <input type="number" class="border p-3 w-full rounded" placeholder="Partnership agreements signed">
          </div>
          <!-- Phase 2 -->
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 2: Implementation & Scale (Months 13‚Äì24)</h4>
            <p class="text-gray-700 mb-4">Strategy: Deliver interventions at scale, continuously monitor outcomes, adapt based on real-time data and feedback.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> 10,000+ beneficiaries directly reached</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Mid-line evaluation conducted and findings acted upon</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Policy advocacy meetings and stakeholder engagements held</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Outcome indicators showing positive trend (mid-line data)</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetC2">0</span> / ‚Ç¶4,000,000</label>
              <input type="range" min="0" max="4000000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetC2').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="Beneficiaries reached this phase">
            <input type="number" class="border p-3 w-full rounded" placeholder="Outcome indicator improvement (%)">
          </div>
          <!-- Phase 3 -->
          <div class="border-l-4 border-indigo-500 pl-6">
            <h4 class="font-bold text-xl mb-2">Phase 3: Sustainability & Exit (Months 25‚Äì36)</h4>
            <p class="text-gray-700 mb-4">Strategy: Institutionalize impact, transfer ownership to local actors, conduct final evaluation, document lessons learned.</p>
            <h5 class="font-medium mb-3 text-lg">Execution Checklist</h5>
            <div class="space-y-3">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Local ownership and capacity transfer completed</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> End-line evaluation and full impact report finalized</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Sustainability plan documented and handed over</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="h-6 w-6"> Project close-out workshop and lessons learned documented</label>
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Budget Tracking</h5>
            <div class="mb-4">
              <label class="block text-sm mb-2">Spent: ‚Ç¶<span id="budgetC3">0</span> / ‚Ç¶3,000,000</label>
              <input type="range" min="0" max="3000000" value="0" class="w-full h-3 bg-gray-300 rounded-lg cursor-pointer" oninput="document.getElementById('budgetC3').textContent = this.value">
            </div>
            <h5 class="font-medium mt-6 mb-3 text-lg">Key Metrics</h5>
            <input type="number" class="border p-3 w-full rounded mb-2" placeholder="Beneficiaries with sustained outcomes">
            <input type="number" class="border p-3 w-full rounded" placeholder="Local actors trained / capacitated">
          </div>
        </div>
        <div class="mt-12 bg-gray-100 p-6 rounded-xl">
          <h3 class="text-2xl font-bold mb-4">Overall Progress</h3>
          <div class="h-4 bg-gray-300 rounded-full overflow-hidden">
            <div class="h-full bg-green-500" style="width:0%"></div>
          </div>
          <p class="text-center mt-2 text-gray-600">0% complete ‚Ä¢ ‚Ç¶0 spent</p>
        </div>
      </div>
    `;
  }

  document.getElementById('execution-content').innerHTML = phasesHTML;

  // Gantt-style chart (visual timeline)
  const ctx = document.createElement('canvas');
  ctx.height = 140;
  document.querySelector('#execution-content canvas')?.parentNode.appendChild(ctx);
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Phase 1', 'Phase 2', 'Phase 3'],
      datasets: [{
        label: 'Duration',
        data: tr === 'A' ? [12, 12, 12] : tr === 'B' ? [6, 12, 6] : [12, 12, 12],
        backgroundColor: '#6366f1',
        barThickness: 40
      }]
    },
    options: {
      indexAxis: 'y',
      scales: { x: { title: { display: true, text: 'Months' } } },
      plugins: { legend: { display: false } }
    }
  });

  showScreen('screen-execution');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Project Progress Dashboard (full as requested)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showProgressDashboard() {
  showScreen('screen-progress');
  loadProgressData();
  switchDashboardMode('owner');
}

function switchDashboardMode(mode) {
  document.getElementById('owner-view').classList.toggle('hidden', mode !== 'owner');
  document.getElementById('admin-view').classList.toggle('hidden', mode !== 'admin');
  document.getElementById('owner-tab').classList.toggle('bg-indigo-600', mode === 'owner');
  document.getElementById('owner-tab').classList.toggle('text-white', mode === 'owner');
  document.getElementById('owner-tab').classList.toggle('bg-gray-200', mode !== 'owner');
  document.getElementById('admin-tab').classList.toggle('bg-indigo-600', mode === 'admin');
  document.getElementById('admin-tab').classList.toggle('text-white', mode === 'admin');
  document.getElementById('admin-tab').classList.toggle('bg-gray-200', mode !== 'admin');
  if (mode === 'admin') renderAdminView();
}

function loadProgressData() {
  const saved = localStorage.getItem('essProgressData');
  if (saved) progressData = JSON.parse(saved);
  else {
    const tr = analysisResult ? analysisResult.primaryTrack : 'B';
    progressData.phases = getDefaultPhases(tr);
  }
  renderOwnerView();
}

function saveProgressData() {
  localStorage.setItem('essProgressData', JSON.stringify(progressData));
}

function getDefaultPhases(tr) {
  if (tr === 'A') return [
    {name:"Foundation (Months 1‚Äì12)", start:"", end:"", checklist:[{text:"Ethics/IRB approval obtained",done:false},{text:"Literature review completed",done:false},{text:"Pilot data collected",done:false}], spent:0, targetBudget:3500000},
    {name:"Core Research (Months 13‚Äì24)", start:"", end:"", checklist:[{text:"Primary dataset collected",done:false},{text:"Analysis completed",done:false}], spent:0, targetBudget:4000000},
    {name:"Synthesis & Dissemination (Months 25‚Äì36)", start:"", end:"", checklist:[{text:"Publications submitted",done:false},{text:"Data archived",done:false}], spent:0, targetBudget:2500000}
  ];
  if (tr === 'B') return [
    {name:"MVP & Validation (Months 1‚Äì6)", start:"", end:"", checklist:[{text:"MVP launched",done:false},{text:"Beta testing completed",done:false}], spent:0, targetBudget:4000000},
    {name:"Growth & Revenue (Months 7‚Äì18)", start:"", end:"", checklist:[{text:"500+ paying customers",done:false},{text:"MRR > ‚Ç¶5M",done:false}], spent:0, targetBudget:3500000},
    {name:"Expansion & Exit Prep (Months 19‚Äì24)", start:"", end:"", checklist:[{text:"New market launched",done:false},{text:"ARR > ‚Ç¶50M",done:false}], spent:0, targetBudget:2500000}
  ];
  return [
    {name:"Preparation & Baseline (Months 1‚Äì12)", start:"", end:"", checklist:[{text:"Baseline survey completed",done:false},{text:"Stakeholders engaged",done:false}], spent:0, targetBudget:3000000},
    {name:"Implementation & Scale (Months 13‚Äì24)", start:"", end:"", checklist:[{text:"10,000+ beneficiaries reached",done:false},{text:"Mid-line evaluation done",done:false}], spent:0, targetBudget:4000000},
    {name:"Sustainability & Exit (Months 25‚Äì36)", start:"", end:"", checklist:[{text:"Ownership transferred",done:false},{text:"End-line evaluation done",done:false}], spent:0, targetBudget:3000000}
  ];
}

function renderOwnerView() {
  let html = '';
  progressData.phases.forEach((phase, i) => {
    const progress = phase.checklist.length ? Math.round(phase.checklist.filter(c => c.done).length / phase.checklist.length * 100) : 0;
    html += `
      <div class="border rounded-2xl p-6 bg-white shadow-sm mb-6">
        <h4 class="font-bold text-lg">${phase.name}</h4>
        <div class="grid grid-cols-2 gap-4 mt-4">
          <div>Start: <input type="date" value="${phase.start||''}" onchange="updatePhase(${i},'start',this.value)" class="border p-2 rounded w-full"></div>
          <div>End: <input type="date" value="${phase.end||''}" onchange="updatePhase(${i},'end',this.value)" class="border p-2 rounded w-full"></div>
        </div>
        <div class="mt-6">
          <h5 class="font-medium mb-3">Checklist (${progress}% complete)</h5>
          ${phase.checklist.map((item,j) => `
            <label class="flex items-center gap-3 mb-3 cursor-pointer">
              <input type="checkbox" ${item.done?'checked':''} onchange="toggleChecklist(${i},${j},this.checked)" class="h-6 w-6">
              ${item.text}
            </label>
          `).join('')}
        </div>
        <div class="mt-8">
          <h5 class="font-medium mb-3">Budget Spent (‚Ç¶${phase.spent||0} / ‚Ç¶${phase.targetBudget||10000000})</h5>
          <input type="range" min="0" max="${phase.targetBudget||10000000}" value="${phase.spent||0}" class="w-full h-3 bg-gray-300 rounded-lg appearance-none cursor-pointer" oninput="updateSpent(${i},this.value)">
        </div>
      </div>
    `;
  });
  document.getElementById('phases-owner').innerHTML = html;
}

function updatePhase(i, field, value) {
  progressData.phases[i][field] = value;
  saveProgressData();
}

function toggleChecklist(i, j, done)
